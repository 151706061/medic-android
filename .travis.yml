language: android
android:
  components:
  - build-tools-22.0.1
  - android-22
before_deploy:
  - "mkdir -p build/publish/travis-${TRAVIS_BUILD_NUMBER}"
  - "cp build/outputs/apk/*-release.apk build/publish/travis-${TRAVIS_BUILD_NUMBER}"
deploy:
  skip_cleanup: true
  provider: s3
  access_key_id: ${s3_access_id}
  secret_access_key:
    secure: ${s3_access_secret}
  bucket: medic-mobile
  local_dir: build/publish
  upload-dir: builds/medic-android
  acl: public_read
  on:
    repo: medic/medic-android
after_success:
  - git config --global user.email "dev@medicmobile.org"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=travis-$TRAVIS_BUILD_NUMBER
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
  - git push origin $GIT_TAG
